- 수동 테스트는 비효율의 극치다.
- 테스트가 너무 늦다.

- 마이크로서비스 아키텍처를 도입하는 중요한 계기중 하나가 테스트성을 개선하는 것이다.

# 9.1 마이크로서비스 아키텍처 테스트 전략

## 9.1.1 테스트 개요

- 테스트 케이스는 어떤 목표를 달성하기 위해 개발된 테스트 입력, 실행 조건, 기대 결과의 집합이다.
- 테스트는 설정(setup) - 실행(exercies) - 확인(verify - assertion) - 정리(teardown) 의 단계로 이루어짐
- 목/스텁을 이용한 테스트
- 테스트 종류
  - 품질 테스트 - 성능, 사용성 테스트
  - 애플리케이션 테스트 - 단위, 통합, 컴포넌트, 종단 간 테스트
- 테스트 사분면: 테스트 분류 기준
  - 비즈니스에 관한 테스트인가, 기술에 관한 테스트인가?
  - 테스트를 하는 목적이 프로그래밍을 지원하기 위함인가, 아니면 애플리케이션을 평가하기 위함인가?
- 테스트를 믿지 못하면 테스트가 실패하더라도 그냥 무시하고 싶어지는 것이 사람 마음이니까 ....
  - 장애 알람 설정 관련도 비슷한 느낌 - 장애가 아닌걸로 알람을 주면 익숙해지고 ... 올라와도 안보게 된다...

## 9.1.2 마이크로서비스 테스트

- MSA 에선 IPC가 중추이다. (380p. 그림 9-6)
- 두 서비스 간의 상호 작용은 다시 말해 두 서비스 사이의 합의 또는 계약이다.
- 두 서비스가 상호 작용할 수 있는지는 모두 실행하고 통신을 일으키는 API를 호출하면 알 수 있다.
  → 너무 스케일이 커진다. → 서비스만 따로 떼어내서 테스트 하는 컨슈머 주도 계약 테스트를 활용하자.
- 컨슈머 주도 계약 테스트
  - 컨슈머 계약 테스트는 프로바이더의 API가 컨슈머가 기대한 바와 일치하는지 확인하는 프로바이더에 대한 통합 테스트이다.
  - 초점은 프로바이더 API의 형상(shape)이 컨슈머가 기대한 것과 부합하는지 확인
    - 컨슈머가 기대한 HTTP 메서드와 경로인가?
    - 컨슈머가 기대한 헤더를 받는가?
    - 요청 본문을 받는가?
    - 컨슈머가 기대한 상태 코드, 헤더, 본문이 포함된 응답을 반환 하는가?
  - 여기까지 봤을 땐 뭔말인지 잘 모르겠다. (384p. 중간)
- 스프링 클라우드 컨트랙트
  - 계약을 그루비 dsl로 작성할 수 있게 지원한다.
  - [https://kouzie.github.io/spring/스프링-클라우드-마이크로서비스-테스트/#pact-provider](https://kouzie.github.io/spring/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%85%8C%EC%8A%A4%ED%8A%B8/#pact-provider)
  -
- 배포 파이프라인

# 9.2 서비스 단위 테스트 작성

- 독립 단위 테스트 : 클래스 디펜던시를 목 객체로 나타내고 따로 테스트
- 공동 단위 테스트 : 클래스와 디펜던시를 테스트
- 컨트롤러 테스트도 단위 테스트 (서비스, 레포 모킹을 통한 단위 테스트)
