# 2. 분해전략

- 이 장에서는 마이크로서비스를 정의하는 방법을 핵심으로 다룬다.
  - DDD의 개념을 이용해서 만능 클래스를 제거하는 방법

# 마이크로서비스 아키텍처란 무엇인가?

- 마이크로서비스 아키텍처의 핵심은 기능 분해로, 대규모 단일 애플리케이션을 개발하는 대신 애플리케이션을 여러 서비스로 구성하자는 것

## 소프트웨어 아키텍처의 정의와 중요성

- 소프트웨어 아키텍처의 정의
  - (69p 하단 소프트웨어 아키텍처 정의 참고)
- 소프트웨어 아키텍처의 4+1뷰 모델
  - 논리 뷰: 소프트웨어 엘리먼트, 클래스와 패키지 등의 관계
  - 구현뷰: 빌드 시스템의 결과물.
  - 프로세스 뷰: 런타임 컴포넌트
  - 배포 뷰: 프로세스가 머신에 매핑되는 방법
- 아키텍처의 중요성
  - 애플리케이션이 해야 할 일을 정의하는 기능 요건
  - 서비스 품질 요건

## 아키텍처 스타일 개요

- 계층화 아키텍처 스타일
  - 표현 계층
  - 비즈니스 로직 계층
  - 영속화 계층
- 육각형 아키텍처 스타일
  - 논리 뷰를 비즈니스 로직 중심으로 구성하는 계층화 아키텍처 스타일의 대안
  - 인바운드 어댑터와 아웃바운드 어댑터를 둔다.
  - 비즈니스로직은 어댑터에 의존하지 않는다.
  - (74p 그림 2-2 참고)

## 마이크로서비스 아키텍처는 일종의 아키텍처 스타일이다

- 마이크로서비스 아키텍처의 핵심 제약 조건은 서비스를 느슨하게 결합한다는 것
- 서비스란 무엇인가
  - 어떤 기능이 구현되어 단독 배포가 가능한 소프트웨어 컴포넌트
  - 서비스는 클라이언트가 자신이 서비스하는 기능에 접근할 수 있도록 커맨드, 쿼리, 이벤트로 구성된 API를 제공
- 느슨한 결합
- 공유 라이브러리의 역할
- 서비스 규모는 별로 중요하지 않다.

# 마이크로서비스 아키텍처 정의

- 애플리케이션은 사용자의 요청을 처리하기 위해 존재한다. 따라서 아키텍처를 정의하는 1단계는 애플리케이션 요건을 핵심 요청으롤 추출하는것 입니다.
  - 1단계 시스템 작업 식별
  - 2단계 서비스 식별
  - 3단계 서비스 API 및 협동 정의
- 분해 과정 장애물
  - 네트워크 지연
  - 서비스간 동기 통신에 의한 가용성이 떨어지는 문제 - 자기 완비형 서비스
  - 데이터 일관성 - 사가
  - 만능 클래스 - DDD

## 시스템 작업 식별

- 1단계는 시스템 작업을 기술하기 위해 필요한 보케블러리를 제공하는 핵심 클래스로 구성된 고수준의 도메인 모델을 생성하는 것
  - (83p 시나리오 참고)
- 2단계는 시스템 작업 식별 후 그 동작을 도메인 모델 관점에서 기술하는 것
  - 시스템 작업은 주로 동사에서 도출하며, 각각 하나 이상의 도메인 객체와 그들 간의 관계로 기술
  - 크게 커맨드, 쿼리의 두 종류로 나눈다.

## 서비스 정의: 비즈니스 능력 패턴별 분해

- 마이크로서비스 아키텍처를 구축하는 첫 번째 전략은 비즈니스 능력에 따라 분해하는 것이다.
- 비즈니스 능력은 곧 조직이 하는 일이다.
- 비즈니스 능력 식별
  - 조직의 목표, 구조, 비즈니스 프로세스를 분석하여 식별한다.
  - FTGO의 경우 공급자 관리, 소비자 관리, 주문 접수 및 이행, 회계 등...
- 비즈니스 능력을 여러 서비스로
- (90p 그림 2-8)
  - 첫 번째 버전에 불과하며 더 정교하게 발전할것
  - IPC가 너무 잦아 분해하는 것이 외려 비효율적이라서 재결합 하는 경우도 있다.

## 서비스 정의: 하위 도메인 패턴별 분해

- DDD는 팀에서 사용할 보케블러리, 즉 공용 언어를 정의한다.
- DDD는 도메인을 구성하는 각 하위 도메인마다 도메인 모델을 따로 정의한다.
- 도메인 모델의 범위를 DDD 용어로는 경계 컨텍스트 라고 한다.
- (92p 그림 2-9)

## 분해 지침

- 단일 책임 원칙
- 공동 폐쇄 원칙

## 서비스 분해의 장애물

- 네트워크 지연
- 동기 IPC로 인한 가용성 저하
- 데이터 일관성 유지
- 일관된 데이터 뷰 확보
- 만능 클래스

## 서비스 API 정의

- 시스템 작업을 서비스로 배정
- 서비스 간 협동 지원에 필요한 API 확정

# 마치며

- 아키텍처는 애플리케이션 개발 속도에 직접 영향을 주는 갖가지 ‘~성’을 좌우합니다.
- 마이크로서비스 아키텍처는 애플리케이션의 관리성, 테스트성, 배포성을 높이는 아키텍처 스타일 입니다.
- 마이크로서비스는 기술적 관심사보다 비즈니스 능력, 하위 도메인 등 비즈니스 관심사 위주로 구성됩니다.
- 서비스를 분해하는 패턴은 크게 두 가지 입니다.
  - 비즈니스 능력에 따른 분해
  - 하위 도메인에 따른 분해
- DDD를 적용하고 서비스마다 도메인 모델을 따로 설계하면, 의존 관계가 뒤엉켜 분해를 가로막는 만능 클래스를 제거할 수 있습니다.
